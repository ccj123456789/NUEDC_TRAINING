# 备赛规划
## 一、小组信息及分工
- 成员一 主要负责软件方向
- 成员二 主要负责硬件方向
- 成员三
### 成员技术栈
- 成员一
熟练使用stm32单片机、Arduion编程、示波器万用表使用
- 成员二
熟练使用stm32单片机、绘制PCB打板、电机驱动模块红外等模块使用
## 二、方向选择
### 2021年F题智能送药小车
#### 1、整体硬件方案设计
根据题目要求，设计出了硬件系统。除了车身结构，控制系统分为 7 个基本 模块，包括主控、视觉模块、驱动模块、药物放入检测模块、灯光显示模块、通信模块、电源模块。
#### 2、车身结构选择 
- 方案一：采用传统四轮车模，将摄像头用纤维杆固定在车头顶端，车身上放置主控以及各模块。
- 方案二：采用抽屉式结构，将物品沿 Z 轴放置于平台之上，摄像头放置到 可调机械臂上用于视野变动。 题目中要求小车长×宽×高不大于25cm×20cm×25cm 且考虑到在弯道处尽量不压线，传统四轮车模难以完成上述功能，因此团队成员摒弃传统车模设定，自定义一款直径 15cm 的圆盘小车，采用三层抽屉式机械机构，分别放置主控系 统、供电系统以及药物。 最终选择方案二的车架结构。 
#### 3、视觉模块 
##### （1）数字识别方案选择 
- 方案一：采用图像模板匹配进行学习，将数字以 1 张图片的形式保存下来并与赛道上的数字进行比较判别。 
- 方案二：采用神经网络算法，对不同光线，视角下的数字照片训练，在 Mv 中调用训练好的模型进行识别。 在实际测试的过程中团队发现，模板匹配方案在速度、方向、光强、高度、角度等各种因素数据特定时检测灵敏，但在实际巡线中的不确定性以及小车自身的反应速度，其模板匹配方案有一定的局限性，受外界环境的影响较大。相比上述方案，在实操中将每个数字选取不同角度的 100 张图片放入机器进行学习，并得出神经网络阵进行路面实际情况检测。使用伸进网络识别速度较快，精度明显高于模板匹配，而且受光线影响小。最终选择神经网络算法。
##### （2）循迹方案比较 
- 方案一：灰度循迹，在车头装若干灰度传感器，根据灰度传感器的返回值 调节小车左右轮速 
- 方案二：采用视觉循迹。红色是三原色之一，对彩色图像通道拆分后可以 轻松找到红色色块，而且这种巡线方式不会被黑色的跑到边界干扰。 两种方案理论上均可实现，实际测试中由于灰度传感器受光线影响较大而且 容易被跑到边界的黑线干扰，而视觉巡线基本不受光线影响，分辨率也远好于灰 度模块循迹。根据 Open Mv 返回的最大红色块坐标判断小车的偏差，并通 过 pid 算法给出电机的控制量，经检验此方案可行，且响应迅速，抗干扰能力好。 最终选择 RGB 视觉巡线。 
#### 4、主控方案 
主控选择 stm32 单片机。该单片机片上资源丰富，定时器还支持直接读取电机编码器，一定程度上可以降低项目的工作量。相对于51，树莓派等，32 单片 机有更复杂的中断系统，更能胜任逻辑量大的程序。 
#### 5、驱动模块控制方案选择 
首先本系统采用有刷减速电机来控制小车运动 
- 方案一：开环控制，直接用 pwm 控制电机转速 
- 方案二：采用闭环控制，读取编码器值计算电机的转速，时刻调节输出功 率让电机在不同负载下维持设定的转速。优先选择了对电机闭环控制。实际测试中，加入闭环后，小车速度会更加稳定，步长控制更加精准，小车左右转等角度不再受到重心或电池电量的 影响。
#### 6、药物到位检测装置 
由于药物重量设定在 200g 左右，团队在药物检测中使用重物阈值检测法。实际操作中，将 200g 砝码放置于压力应变片上时会有电压改变，但检测精度不 高，在 1kg 量程左右变化，对于题目中 200g 检测并不是很灵敏，因此，将信号进行了放大，并用 ADC 采集判断。此外，加入光电传感器使判断更加可靠。
### 方向所需技术栈
- 熟练使用stm32单片机、openmv、电机驱动模块、编码器、超声波模块、红外/灰度传感器
- 会使用巡线算法、数字识别
-熟练巡线环（方向误差）、位移环（位置误差）、速度环（电机调速）三级PID
- OpenMV与STM32串口通讯
### 2020年非接触物体尺寸形态测量（G 题）
#### 1、方案总体设计
该系统主要由 STM32F103系列单片机，机器视觉模块，激光测距模块，人机交互模块以及二维云台组成。整个系统首先利用视觉模块获取被测物体的尺寸与大小，同时再加上测距模块来获取被测物与装置之间的距离，经过信号调理以后，便把数据发送给了STM32单片机进行运算处理，最终将测量数据显示在oled屏上。
#### 2、方案
基于OpenMV利用AGAST特征点检测算法实现目标检测。
优点：AGAST特征点检测算法主要应用于提取图像中的特征点，在动态成像的一系列图像中追踪定位对象。在目标检测中，不仅具有方向性和尺度不变性同时计算量较小。
缺点：编程较为复杂
#### 3、形状识别
基于视觉的非接触测量过程可以分为相机标定、图像采集、图像预处理、ROI区域提取，边缘检测／ 连通域分析，零件特征数据采集、零件形位公差分析几个步骤。
#### 4、主控模块
出于成本考虑，使用自制OpenMV机器视觉模块。包括主控电路、电源电路、拓展IO口、SD卡接口和摄像头接口等。主控选择STM32H743高性能单片机，可以同时满足系统功耗与性能的要求。
#### 5、工作流程
12V 直流稳压电源通过 5V 和 3.3.V 稳压模块分别向单片机和 OpenMV供电；目标物体的水平距离通过激 光测距模块读取并转化为距离数字量传回单片机中；目标物体的几何形状以及坐标通过 OpenMV 的颜色识别读取，并转化为位置数字量 传回单片机中；单片机将激光测距模块读取的距离数据处理后传OpenMV ，OpenMV 经比例计算后返回物体边长的数字量；最后单片机将目标物体的形状、边长和距离数据传给 OLED 显示；进入自动寻找目标时，单片机根据 OpenMV 传回的坐标数据控制云台舵机转动角度；当测量结果稳定后启动声光提示，表示当前测量任务完成；单片机的电平信号可控制由发光二极管和有源蜂鸣器组成的声光提示部分。
### 方向所需技术栈
- 熟练使用stm32单片机、openmv、陀螺仪、舵机云台、蜂鸣器、发光二极管、激光测距模块、oled显示屏
- 会形状识别、AGAST特征点检测算法
## 三、设备清单
### 1、工具
热风枪、电烙铁
### 2、硬件材料
小车底盘、电池、最小系统板stm32、电机驱动模块、openmv、陀螺仪、编码器、超声波模块、红外/灰度传感器、oled显示屏、LED指示灯
### 3、软件工具链
代码编程使用keil5，代码管理github、openmv IDE
## 四、学习计划
### 1、3.16——3.22
学习编码电机，复习stm32单片机，搭建小车、画板
### 2、3.23——3.29
学习超声波模块、红外/灰度传感器，学习openmv视觉（数字识别、巡线等等）
### 3、3.30——4.5
学习PID调参巡线环（速度环）
### 4、4.6——4.11
基本完成题目一
### 5、4.13——4.19
学习陀螺仪、舵机云台
### 6、4.20——4.26
升级模糊自适应PID、添加辅助姿态修正
### 7、4.27——5.3
进阶学习视觉控制
### 8、5.4——5.9
完美完成题目一或基本完成题目二
### 9、5.12——6.6
构建通用方案